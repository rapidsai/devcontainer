name: image-info

description: Setup self-hosted runner environment

inputs:
  arch:
    type: string
    required: true

runs:
  using: composite
  steps:
    - if: contains(runner.name, 'rapidsai') == true
      name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '16'

    - name: Setup self-hosted runner environment
      if: contains(runner.name, 'rapidsai') == true
      shell: bash -xeo pipefail {0}
      run: |
        echo "${{ toJSON(runner) }}";

        echo "HOME=${{ runner.workspace }}" >> $GITHUB_ENV;
        echo "TMPDIR=${{ runner.temp }}" >> $GITHUB_ENV;

        sudo mkdir -p /usr/local/lib/docker/cli-plugins;
        sudo curl -s \
            -L "https://github.com/docker/buildx/releases/download/v0.10.1/buildx-v0.10.1.linux-${{ inputs.arch }}" \
            -o "/usr/local/lib/docker/cli-plugins/buildx";
        sudo chmod +x /usr/local/lib/docker/cli-plugins/buildx;
        stat /usr/local/lib/docker/cli-plugins/buildx;

        which -a docker;
        docker --version;
        docker buildx version;
