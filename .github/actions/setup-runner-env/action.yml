name: image-info

description: Setup self-hosted runner environment

runs:
  using: composite
  steps:
    - name: Setup self-hosted runner environment
      shell: bash --noprofile --norc -xeo pipefail {0}
      run: |
        echo "${{ toJSON(runner) }}";

        cd "${{ runner.workspace }}/devcontainers";
        mkdir -p "./_temp";

        echo "TMPDIR=./_temp" >> $GITHUB_ENV;
        echo "HOME=${{ runner.workspace }}" >> $GITHUB_ENV;

        sudo ln -s "$(realpath -m ../../)" /data;

        find "${{ runner.workspace }}" -type d;

        # echo "TMPDIR=/data/_temp" >> $GITHUB_ENV;
        # echo "HOME=/data/devcontainers" >> $GITHUB_ENV;

        # data="${{ runner.workspace }}/../";
        # data="$(realpath -m "$data")";
        # sudo ln -s "$data" "/data";
        sudo ln -s "$(realpath -m ../../)" /data;

        sudo chown -R $(id -u):$(id -g) "/data";
        sudo chown -R $(id -u):$(id -g) "$data";

        find /data/ -type d;
        # find $data/ -type d;
