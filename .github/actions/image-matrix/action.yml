name: image-matrix

description: Determine the image matrix

outputs:
  matrix:
    value: ${{ steps.matrix.outputs.matrix }}

runs:
  using: composite
  steps:
    - name: Determine the image matrix
      id: matrix
      shell: bash
      run: |
        echo "matrix=$(
        cat <<EOF | yq -o json --no-colors | jq -c -r -M '.matrix'
        matrix:
          LLVM: ["", "llvm15", "llvm16"]
          RUST: ["", "rust"]
          CUDA: ["", "cuda11.8", "cuda12.0"]
          NVHPC: ["", "nvhpc23.1"]
          MAMBA: ["", "mambaforge"]
          exclude:
            - { RUST: "rust", NVHPC: "nvhpc23.1" }
            - { RUST: "rust", CUDA: "", LLVM: "", NVHPC: "" }
            - { NVHPC: "nvhpc23.1",        MAMBA: "mambaforge" }
            - { CUDA: "",         LLVM: "", MAMBA: "mambaforge" }
            - { CUDA: "cuda11.8", LLVM: "", NVHPC: "nvhpc23.1" }
            - { CUDA: "cuda12.0", LLVM: "", NVHPC: "nvhpc23.1" }
        EOF
        )" | tee -a $GITHUB_OUTPUT;
